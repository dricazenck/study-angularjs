<!DOCTYPE html>
<html lang="en" ng-app="order" ng-controller="OrderController as orderCtrl">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>{{orderCtrl.titleApp}}</title>
        <link rel="stylesheet" href="css/bootstrap.min.css" />
        <link rel="stylesheet" href="css/order.css" />
    </head>

    <body>
        <div>
            <h2 class="page-header">{{orderCtrl.nameApp}}</h2>

            <div class="panel panel-default category">
                <div class="panel-heading">
                    <h3 class="panel-title">Menu</h3>
                </div>
                <div class="panel-body">
                    
                    <input class="form-control" type="text" ng-model="orderCtrl.keySearch" placeholder="Filter..."  >

                    <table class="table table-striped table-hover">
                        <thead>
                            <th>#</th>
                            <th><a href="" ng-click="orderCtrl.defineOrderBy('name')">Drink</a></th>
                            <th><a href="" ng-click="orderCtrl.defineOrderBy('price')">Price</a></th>
                        </thead>
                        <tr ng-repeat="product in orderCtrl.products | filter:orderCtrl.keySearch | orderBy:orderCtrl.field:orderCtrl.reverse">
                            <td>{{product.id}}</td>
                            <td>{{product.name | uppercase | limitTo:19 | exclamation:2 }}</td>
                            <td>{{product.price | currency}}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="panel panel-default category">
                <div class="panel-heading">
                    <h3 class="panel-title">Ordering Drinks</h3>
                </div>

                <div class="panel-body">
                    
                    <div class="alert alert-warning"  ng-show="orderForm.table.$invalid && orderForm.table.$dirty">Table is required</div>
                    <div class="alert alert-warning" ng-show="orderForm.quantity.$error.required && orderForm.quantity.$dirty">Quantity is required</div>
                    <div class="alert alert-warning" ng-show="orderForm.quantity.$error.pattern">Should be just numbers in quantity field</div>
                    <div class="alert alert-warning" ng-show="orderForm.product.$error.required && orderForm.product.$dirty">Drink is required</div>
                
                    <form name="orderForm">
                        <div class="form-group">
                            <label>Table Number</label>
                            <input ng-model="orderCtrl.order.table" name="table" ng-required="true" type="text" class="form-control" placeholder="Insert table number">
                        </div>
                        <div>
                            <div class="form-group order-drink">
                                <label>Drink</label>
                                <select ng-model="orderCtrl.item.product" name="product" ng-required="true"  ng-options="product.name for product in orderCtrl.products"
                                type="select" class="form-control">
                                    <option value="">--- Select one drink ---</option>
                                </select>
                            </div>  
                            <div class="form-group order-quantity">
                                <label>Quantity</label>
                                <input ng-model="orderCtrl.item.quantity" name="quantity" maxlength="2" ng-required="true" type="text" class="form-control" ng-pattern="/^\d+$/">
                            </div> 
                        </div>
                        
                        <button class="btn btn-default" ng-disabled="orderForm.$invalid" ng-click="orderCtrl.addItem(orderCtrl.item)">Insert new drink</button>
                    </form>
                    <div class="form-group" ng-hide="orderCtrl.order.items.length == 0">
                        <h3>Items</h3>

                        <table class="table table-striped table-hover">
                            <thead>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Subtotal</th>
                            </thead>
                            <tr ng-repeat="item in orderCtrl.order.items">
                                <td>{{item.product.name}}</td>
                                <td>{{item.quantity}}</td>
                                <td>{{item.product.price | currency}}</td>
                                <td>{{item.subtotal}}</td>
                            </tr>
                            <thead>
                                <th></th>
                                <th></th>
                                <th>Total</th>
                                <th>{{orderCtrl.order.getTotal() | currency}}</th>
                            </thead>
                        </table>
                    </div>
                    
                    <button ng-hide="orderCtrl.order.items.length == 0" ng-click="orderCtrl.finalizeOrder(orderCtrl.order)" class="btn btn-default">Finalize Order</button>
                </div>
            </div>
        
            <div class="panel panel-default category" ng-if="orderCtrl.orders.length > 0">
                <div class="panel-heading">
                    <h3 class="panel-title">Ordered</h3>
                </div>
                <div class="panel-body">
	                <table class="table table-striped table-hover" ng-hide="orderCtrl.details">
	                    <thead>
	                        <th>#</th>
	                        <th><a href="" ng-click="orderCtrl.defineOrderByOrders('table')">Table</a></th>
                            <th><a href="" ng-click="orderCtrl.defineOrderByOrders('date')">Date</a></th>
	                        <th><a href="" ng-click="orderCtrl.defineOrderByOrders('status')">Status</a></th>
	                        <th><a href="" ng-click="orderCtrl.defineOrderByOrders('getTotal()')">Total</a></th>
                            <th>Action</th>
	                    </thead>
	                    <tr ng-repeat="order in orderCtrl.orders | orderBy: orderCtrl.fieldOrder:orderCtrl.reverseOrder">
	                        <td>
                                <a href="#" ng-click="orderCtrl.showDetailsOrder(order)">{{order.id}}</a>
                            </td>
	                        <td>{{order.table}}</td>
                            <td>{{order.date | date : 'dd/MM/yyyy HH:mm:ss'}}</td>
	                        <td>{{order.status}}</td>
	                        <td>{{order.getTotal() | currency}}</td>
                            <td>
                                <a href="#" ng-show="order.status == 'Ok'" ng-click="orderCtrl.cancelOrder(order)">Cancel</a>
                                <a href="#" ng-show="order.status != 'Ok'" ng-click="orderCtrl.deleteOrder(order)">Delete</a>
                            </td>
	                    </tr>
	                </table>

                    <div class="form-group" ng-show="orderCtrl.details">
                        <h4>Details Order {{orderCtrl.details.id}} - Table {{orderCtrl.details.table}} </h4>

                        <table class="table table-striped table-hover">
                            <thead>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Subtotal</th>
                            </thead>
                            <tr ng-repeat="item in orderCtrl.details.items">
                                <td>{{item.product.name}}</td>
                                <td>{{item.quantity}}</td>
                                <td>{{item.product.price | currency}}</td>
                                <td>{{item.subtotal | currency}}</td>
                            </tr>
                        </table>
                        <button class="btn btn-default" ng-click="orderCtrl.closeDetails()">Return</button>
                    </div>

                </div>
            </div>
        </div>

        <script src="lib/angular.min.js"></script> 
        <script src="lib/angular-locale_pt-br.js"></script> 
        <script src="js/models.js"></script>
        <script src="js/app.js"></script>
    </body>
</html>